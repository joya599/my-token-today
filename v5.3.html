<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æœ¬ä¸¸è¿‘ä¾æ—¥å†</title>
    <style>
        :root {
            --primary-red: #d32f2f;
            --paper-bg: #fcfaf2;
            --ink-black: #2c3e50;
        }

        body, button, input, select, summary {
            font-family: "æ¥·ä½“", "STKaiti", "BiauKai", serif;
        }

        body {
            background-color: var(--paper-bg);
            margin: 0; padding: 0;
            color: var(--ink-black);
            scroll-behavior: smooth;
        }

        /* --- æŠ½ç­¾ä¸»åŒº --- */
        .draw-section {
            height: 100vh;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center;
        }

        #lotto-box {
            width: 120px; height: 160px;
            background: #8d6e63; border: 5px solid var(--ink-black);
            border-radius: 10px 10px 60px 60px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 1.8rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            margin-bottom: 30px;
        }

        .shaking { animation: shake 0.15s infinite; }
        @keyframes shake {
            0% { transform: rotate(0); }
            25% { transform: rotate(-8deg); }
            75% { transform: rotate(8deg); }
        }

        button#drawBtn {
            padding: 15px 50px; font-size: 1.6rem;
            background: var(--primary-red); color: white;
            border: none; border-radius: 60px; cursor: pointer;
            box-shadow: 0 5px rgba(0,0,0,0.2);
            transition: 0.3s;
        }

        /* --- å¼¹çª— (æ·¡è‰²æ–¹æ¡ˆ) --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); 
            display: none; justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(6px);
        }

        #result-card {
            width: 85%; max-width: 400px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 50px 35px;
            text-align: center;
            box-sizing: border-box;
            border: 4px solid #fff;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            animation: cardPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: all 0.3s ease;
        }

        @keyframes cardPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        #card-name { font-size: 2.5rem; font-weight: bold; margin-bottom: 30px; transition: color 0.3s; }
        #card-portrait { width: 100%; max-height: 380px; object-fit: contain; margin-bottom: 30px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1)); }
        .mood-btn { background: white; border: 1px solid #eee; padding: 15px 30px; border-radius: 50px; cursor: pointer; font-size: 1.2rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        /* --- å¸ƒå±€ --- */
        .manage-section { padding: 40px 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; background: white; border-top: 2px solid var(--ink-black); }
        @media (max-width: 768px) { .manage-section { grid-template-columns: 1fr; } }
        .panel { border: 2px solid #efebe9; border-radius: 15px; padding: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day { border: 1px solid #f9f9f9; min-height: 85px; display: flex; flex-direction: column; align-items: center; font-size: 0.8rem; }
        .calendar-day-accent { width: 100%; height: 24px; display: flex; align-items: center; justify-content: center; color: white; margin-bottom: 4px; }
        .collection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; }
        .collection-item { padding: 10px 5px; border-radius: 6px; text-align: center; font-size: 0.85rem; color: #ccc; background: #fff; border: 1px solid #eee; }
        .collection-item.unlocked { color: white; font-weight: bold; border: none; }
        .sakura { position: fixed; top: -20px; z-index: 2000; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
        .name-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; padding: 15px; }
        summary { cursor: pointer; padding: 10px; font-weight: bold; background: #fdfdfd; }
    </style>
</head>
<body>

<div class="draw-section">
    <h1 style="letter-spacing: 6px; font-size: 2.5rem;">æœ¬ä¸¸è¿‘ä¾æŠ½é€‰</h1>
    <div id="lotto-box">ç­¾ç­’</div>
    <button id="drawBtn">èµ·æ‰‹æ‘‡ç­¾</button>
    <p style="margin-top:30px; color:#aaa; cursor:pointer;" onclick="document.getElementById('manage').scrollIntoView({behavior:'smooth'})">æŸ¥çœ‹è®°å½•ä¸å›¾é‰´ â–½</p>
</div>

<div id="modal-overlay" onclick="closeModal()">
    <div id="result-card" onclick="event.stopPropagation()">
        <div id="card-name"></div>
        <img id="card-portrait" src="" alt="">
        <button id="cardMoodBtn" class="mood-btn">ğŸ è¯¢é—®ä»Šæ—¥å¿ƒæƒ…</button>
        <div style="margin-top: 30px; color: #999; font-size: 0.9rem;">ç‚¹å‡»å¤–éƒ¨è¿”å›æœ¬ä¸¸</div>
    </div>
</div>

<div class="manage-section" id="manage">
    <div class="panel">
        <h2>å‡ºé˜µåå•</h2>
        <div id="nameContainer"></div>
    </div>
    <div class="panel">
        <h2>å²ä¹¦è®°å½•</h2>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>
</div>

<div style="padding: 40px 20px; background: var(--paper-bg); border-top: 1px solid #ddd;">
    <h2 style="text-align: center;">æœ¬æœˆæˆå°±å›¾é‰´</h2>
    <div id="collectionContainer"></div>
</div>

<script>
    const imgHost = "portraits/";
    const data = {
        "çŸ­åˆ€": ["ä»ŠåŠ", "å¹³é‡è—¤å››éƒ", "åšè—¤å››éƒ", "å¾Œè—¤è—¤å››éƒ", "ä¿¡æ¿ƒè—¤å››éƒ", "å‰ç”°è—¤å››éƒ", "ç§‹ç”°è—¤å››éƒ", "åšå¤šè—¤å››éƒ", "ä¹±è—¤å››éƒ", "äº”è™é€€", "è—¥ç ”è—¤å››éƒ", "åŒ…ä¸è—¤å››éƒ", "æ„›æŸ“å›½ä¿Š", "å¤ªé¼“é˜è²å®—", "å°å¤œå·¦æ–‡å­—", "ä¸å‹•è¡Œå…‰", "æ¯›åˆ©è—¤å››éƒ", "è¬™ä¿¡æ™¯å…‰", "æ—¥å‘æ­£å®—", "åŒ—è°·èœåˆ‡", "å¤ªé–¤å·¦æ–‡å­—", "äº¬æ¥µæ­£å®—", "ä¹é¬¼æ­£å®—", "ä¿±åˆ©ä¼½ç¾…æ±Ÿ"],
        "è„‡å·®": ["ç¬‘é¢é’æ±Ÿ", "é¯°å°¾è—¤å››éƒ", "éª¨å–°è—¤å››éƒ", "ç‰©å‰è²å®—", "å €å·å›½å¹¿", "æµ¦å³¶è™å¾¹", "ç¯­æ‰‹åˆ‡æ±Ÿ", "è‚¥å‰å¿ åºƒ", "æ²»é‡‘ä¸¸", "æ³›å¡µ", "ç«è»Šåˆ‡"],
        "æ‰“åˆ€": ["é³´ç‹", "åƒå­æ‘æ­£", "äº€ç”²è²å®—", "å®—ä¸‰å·¦æ–‡å­—", "åŠ å·æ¸…å…‰", "å¤§å’Œå®ˆå®‰å®š", "æ­Œä»™å…¼å®š", "å’Œæ³‰å®ˆå…¼å®š", "é™¸å¥¥å®ˆå‰è¡Œ", "å±±å§¥åˆ‡å›½å¹¿", "èœ‚é ˆè³€è™å¾¹", "é•·æ›½ç¥¢è™å½»", "å¤§ä¿±åˆ©ä¼½ç¾…", "å£“åˆ‡é•·è°·éƒ¨", "åŒç”°è²«æ­£å›½", "å—æ³‰ä¸€æ–‡å­—", "å±±å§¥åˆ‡é•·ç¾©", "è±Šå‰æ±Ÿ", "å—æµ·å¤ªéƒæœå°Š", "æ¡‘åæ±Ÿ", "æ°´å¿ƒå­æ­£ç§€", "æºæ¸…éº¿", "æ¾äº•æ±Ÿ", "åœ°è—è¡Œå¹³", "äº”æœˆé›¨æ±Ÿ", "æ‘é›²æ±Ÿ", "ç¨»è‘‰æ±Ÿ", "çŸ³ç”°æ­£å®—", "å­«å…­å…¼å…ƒ", "å¾Œå®¶å…¼å…‰", "å¯Œç”°æ±Ÿ", "å¤§æ…¶ç›´èƒ¤", "å®‰å®…åˆ‡", "äºŒç­‹æ¨‹è²å®—"],
        "å¤ªåˆ€": ["ç«¥å­åˆ‡å®‰ç¶± å‰¥è½", "ä¸‰æ—¥æœˆå®—è¿‘", "å°ç‹ä¸¸", "å¤§å…¸å¤ªå…‰ä¸–", "é¨·é€Ÿä¹‹åŠ", "æ•°ç ä¸¸æ’æ¬¡", "é¬¼ä¸¸å›½ç¶±", "ä¸€æœŸä¸€æŒ¯", "å¤§åŒ…å¹³", "é¶¯ä¸¸", "æ˜çŸ³å›½è¡Œ", "ç‡­å°åˆ‡å…‰å¿ ", "å¤§èˆ¬è‹¥é•·å…‰", "å°é¾æ™¯å…‰", "æ±Ÿé›ªå·¦æ–‡å­—", "å±±ä¼å›½å¹¿", "é«­åˆ‡", "è†ä¸¸", "ç…å­ç‹", "å°çƒä¸¸", "é¶´ä¸¸å›½æ°¸", "æ‹”ä¸¸", "å°è±†é•·å…‰", "åƒä»£é‡‘ä¸¸", "å±±é³¥æ¯›", "å¤ä»Šå‚³æˆä¹‹å¤ªåˆ€", "æ—¥å…‰ä¸€æ–‡å­—", "ä¸€æ–‡å­—å‰‡å®—", "å§¬é¶´ä¸€æ–‡å­—", "ç¦å³¶å…‰å¿ ", "ç¬¹è²«", "å…«ä¸å¿µä½›", "å®Ÿä¼‘å…‰å¿ ", "é›²ç”Ÿ", "é“èª‰ä¸€æ–‡å­—", "é›²æ¬¡", "é¢å½±", "å¤å‚™å‰ä¿¡æˆ¿", "ä¸‰éƒå›½å®—"],
        "å¤§å¤ªåˆ€": ["çŸ³åˆ‡ä¸¸", "è¢ä¸¸", "å¤ªéƒå¤ªåˆ€", "æ¬¡éƒå¤ªåˆ€", "ç¥¢ç¥¢åˆ‡ä¸¸"],
        "è–™åˆ€": ["å²©è", "å·´å½¢è–™åˆ€", "é™å½¢è–™åˆ€"],
        "æª": ["èœ»è›‰åˆ‡", "æ—¥æœ¬å·", "å¾¡æ‰‹æµ", "å¤§åƒé³¥åæ–‡å­—æ§", "äººé—´æ— éª¨"],
        "å‰‘": ["ç™½å±±å‰å…‰", "ä¸ƒæ˜ŸåŠ", "ä¸™å­æ¤’æ—åŠ"]
    };

    const COLORS = {
        "ä¸‰æ—¥æœˆå®—è¿‘": "#274b85", "å°ç‹ä¸¸": "#d6b214", "çŸ³åˆ‡ä¸¸": "#789658", "å²©è": "#74288a", "ä»ŠåŠ": "#e94c5f",
        "å¤§å…¸å¤ªå…‰ä¸–": "#6b7386", "é¨·é€Ÿä¹‹åŠ": "#f6ea86", "æ•°ç ä¸¸æ’æ¬¡": "#474398", "ç¬‘é¢é’æ±Ÿ": "#61816a",
        "é¬¼ä¸¸å›½ç¶±": "#27314c", "é³´ç‹": "#fff3c1", "ä¸€æœŸä¸€æŒ¯": "#72b6b5", "é¯°å°¾è—¤å››éƒ": "#5e3766",
        "éª¨å–°è—¤å››éƒ": "#b6adbe", "å¹³é‡è—¤å››éƒ": "#7c6659", "åšè—¤å››éƒ": "#b9b1af", "å¾Œè—¤è—¤å››éƒ": "#a87059",
        "ä¿¡æ¿ƒè—¤å››éƒ": "#ab1f2a", "å‰ç”°è—¤å››éƒ": "#a99477", "ç§‹ç”°è—¤å››éƒ": "#ef9499", "åšå¤šè—¤å››éƒ": "#ca661b",
        "ä¹±è—¤å››éƒ": "#ecba99", "äº”è™é€€": "#e8e0cd", "è—¥ç ”è—¤å››éƒ": "#8e6881", "åŒ…ä¸è—¤å››éƒ": "#b5948f",
        "æ¯›åˆ©è—¤å››éƒ": "#a7c57f", "ç™½å±±å‰å…‰": "#9cbfdf", "å¤§åŒ…å¹³": "#742b36", "é¶¯ä¸¸": "#748457", 
        "å…«ä¸å¿µä½›": "#29479d", "å¤å¤‡å‰ä¿¡æˆ¿": "#BF7F1F", "æ˜çŸ³å›½è¡Œ": "#393a3c", "è¢ä¸¸": "#a9c463", 
        "æ„›æŸ“å›½ä¿Š": "#db4135", "é¢å½±": "#BB94C0", "åƒå­æ‘æ­£": "#e3b6d3", "èœ»è›‰åˆ‡": "#95397a", 
        "ç‰©å‰è²å®—": "#e7a58b", "å¤ªé¼“é˜è²å®—": "#2967b0", "äº€ç”²è²å®—": "#d0355f", "äºŒç­‹æ¨‹è²å®—": "#304878", 
        "ç‡­å°åˆ‡å…‰å¿ ": "#435b73", "å¤§èˆ¬è‹¥é•·å…‰": "#771218", "å°é¾æ™¯å…‰": "#006591", "è¬™ä¿¡æ™¯å…‰": "#00469b", 
        "å°è±†é•·å…‰": "#6f1838", "ç¦å³¶å…‰å¿ ": "#313a65", "å®Ÿä¼‘å…‰å¿ ": "#644388", "å¾Œå®¶å…¼å…‰": "#D9919c", 
        "å®‰å®…åˆ‡": "#363545", "å±±å§¥åˆ‡é•·ç¾©": "#a3b4d2", "æ±Ÿé›ªå·¦æ–‡å­—": "#d7ebec", "å®—ä¸‰å·¦æ–‡å­—": "#cb858d", 
        "å°å¤œå·¦æ–‡å­—": "#2686ae", "å¤ªé–¤å·¦æ–‡å­—": "#f6f4c4", "æ­Œä»™å…¼å®š": "#644f6d", "å’Œæ³‰å®ˆå…¼å®š": "#8a272a", 
        "äººé—´æ— éª¨": "#a7a7c3", "å±±å§¥åˆ‡å›½å¹¿": "#46677a", "å±±ä¼å›½å¹¿": "#c2802c", "å €å·å›½å¹¿": "#5bacc7",
        "èœ‚é ˆè³€è™å¾¹": "#bc84ab", "æµ¦å³¶è™å¾¹": "#f49d00", "é•¿æ›½ç¥¢è™å½»": "#504f4b", "å¤§ä¿±åˆ©ä¼½ç¾…": "#94442b",
        "ç«è»Šåˆ‡": "#cf3b2d", "ç¯­æ‰‹åˆ‡æ±Ÿ": "#495e37", "è±Šå‰æ±Ÿ": "#d0273d", "æ¡‘åæ±Ÿ": "#f8b300",
        "æ¾äº•æ±Ÿ": "#0b80a3", "äº”æœˆé›¨æ±Ÿ": "#70549f", "æ‘é›²æ±Ÿ": "#ef9098", "ç¨»è‘‰æ±Ÿ": "#3c403f",
        "å¯Œç”°æ±Ÿ": "#E7DCB0", "ä¿±åˆ©ä¼½ç¾…æ±Ÿ": "#8E8A89", "æ—¥å‘æ­£å®—": "#a31d3d", "çŸ³ç”°æ­£å®—": "#d8e1ce",
        "äº¬æ¥µæ­£å®—": "#5f001e", "ä¹é¬¼æ­£å®—": "#e7ebf4", "å—æ³‰ä¸€æ–‡å­—": "#f6ca81", "å±±é³¥æ¯›": "#b5bdc8", 
        "æ—¥å…‰ä¸€æ–‡å­—": "#5e3f85", "ä¸€æ–‡å­—å‰‡å®—": "#da1c1e", "å§¬é¶´ä¸€æ–‡å­—": "#3c4451", "é“èª‰ä¸€æ–‡å­—": "#631022", 
        "å¤ä»Šå‚³æˆä¹‹å¤ªåˆ€": "#f1cdc1", "åœ°è—è¡Œå¹³": "#517897", "é›²ç”Ÿ": "#3FB9BE", "é›²æ¬¡": "#F18d01", 
        "ç«¥å­åˆ‡å®‰ç¶± å‰¥è½": "#BDBCBD", "åŠ å·æ¸…å…‰": "#a73d51", "å¤§å’Œå®ˆå®‰å®š": "#4485c7", "é™†å¥¥å®ˆå‰è¡Œ": "#b14322", 
        "é«­åˆ‡": "#e7dfb0", "è†ä¸¸": "#bbd6c3", "å£“åˆ‡é•·è°·éƒ¨": "#584a6d", "ä¸åŠ¨è¡Œå…‰": "#6f6798", 
        "ç‹®å­ç‹": "#c0ac4d", "å°çƒä¸¸": "#cf111b", "æ‹”ä¸¸": "#c31c25", "åŒç”°è²«æ­£å›½": "#90817e", 
        "é¹¤ä¸¸å›½æ°¸": "#d7d9d8", "å¤ªéƒå¤ªåˆ€": "#69367F", "æ¬¡éƒå¤ªåˆ€": "#404d60", "æ—¥æœ¬å·": "#38394b", 
        "å¾¡æ‰‹æµ": "#4b543f", "å·´å½¢è–™åˆ€": "#92cce0", "é™å½¢è–™åˆ€": "#d52317", "åƒä»£é‡‘ä¸¸": "#00aec9", 
        "ç¥¢ç¥¢åˆ‡ä¸¸": "#7d2231", "å—æµ·å¤ªéƒæœå°Š": "#283555", "è‚¥å‰å¿ åºƒ": "#5f1013", "åŒ—è°·èœåˆ‡": "#f391c3", 
        "æ°´å¿ƒå­æ­£ç§€": "#a89fce", "æºæ¸…éº¿": "#4b266b", "æ²»é‡‘ä¸¸": "#f9cd46", "å¤§åƒé³¥åæ–‡å­—æ§": "#ab9997", 
        "æ³›å¡µ": "#ef9098", "ä¸ƒæ˜ŸåŠ": "#1c1b20", "ä¸™å­æ¤’æ—åŠ": "#7e7eba", "ç¬¹è²«": "#396122", 
        "å­™å…­å…¼å…ƒ": "#464147", "å¤§æ…¶ç›´èƒ¤": "#4b3f81", "ä¸‰éƒå›½å®—": "#D61518"
    };

    function getCardColor(name) { return COLORS[name] || "#8d6e63"; }

    let historyData = JSON.parse(localStorage.getItem("touken_history_v1")) || {};
    let savedChecked = JSON.parse(localStorage.getItem("touken_checked_v1"));

    const nameContainer = document.getElementById('nameContainer');
    const collectionContainer = document.getElementById('collectionContainer');

    // æ¸²æŸ“åå•å¹¶æ¢å¤å‹¾é€‰ (æ ¸å¿ƒè®°å¿†åŠŸèƒ½)
    for (let type in data) {
        let det = document.createElement('details');
        let sum = document.createElement('summary'); sum.textContent = type;
        let grid = document.createElement('div'); grid.className = 'name-grid';
        data[type].forEach(name => {
            let isChecked = savedChecked ? savedChecked.includes(name) : true;
            grid.innerHTML += `<label><input type="checkbox" class="name-cb" value="${name}" ${isChecked ? 'checked' : ''} onchange="saveSelection()"> ${name}</label>`;
        });
        det.append(sum, grid); nameContainer.append(det);

        let h3 = document.createElement('h3'); h3.innerText = type;
        let collGrid = document.createElement('div'); collGrid.className = 'collection-grid'; collGrid.id = `coll-${type}`;
        collectionContainer.append(h3, collGrid);
    }

    // ä¿å­˜å‹¾é€‰çŠ¶æ€
    function saveSelection() {
        const checked = Array.from(document.querySelectorAll('.name-cb:checked')).map(cb => cb.value);
        localStorage.setItem("touken_checked_v1", JSON.stringify(checked));
    }

    const drawBtn = document.getElementById('drawBtn');
    const overlay = document.getElementById('modal-overlay');
    const resultCard = document.getElementById('result-card');
    const cardName = document.getElementById('card-name');
    const cardPortrait = document.getElementById('card-portrait');
    const cardMoodBtn = document.getElementById('cardMoodBtn');

    drawBtn.onclick = function() {
        const pool = Array.from(document.querySelectorAll('.name-cb:checked')).map(cb => cb.value);
        if (pool.length === 0) return alert("è¯·å…ˆå‹¾é€‰åå•");
        
        drawBtn.disabled = true;
        document.getElementById('lotto-box').classList.add('shaking');

        setTimeout(() => {
            document.getElementById('lotto-box').classList.remove('shaking');
            const winner = pool[Math.floor(Math.random() * pool.length)];
            const color = getCardColor(winner);
            
            cardName.innerText = winner;
            cardPortrait.src = imgHost + winner + ".png";
            
            // --- å¼¹çª—æ·¡è‰²ä¼˜åŒ– ---
            resultCard.style.backgroundColor = color + "26"; // 15% é€æ˜åº¦
            resultCard.style.borderColor = color;
            cardName.style.color = color;
            
            cardMoodBtn.innerText = "ğŸ è¯¢é—®ä»Šæ—¥å¿ƒæƒ…";
            cardMoodBtn.onclick = () => getMood(winner);

            overlay.style.display = 'flex';
            
            const d = new Date();
            historyData[`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`] = winner;
            localStorage.setItem("touken_history_v1", JSON.stringify(historyData));
            renderEverything();
            drawBtn.disabled = false;
        }, 1000);
    };

    function closeModal() { overlay.style.display = 'none'; }

    function getMood(winner) {
        const moods = [
			{ text: "ğŸŒ¸ æ¨±å¹é›ªï¼èº«ä½“è½»ç›ˆï¼ŒçŠ¶æ€ç»ä½³ï¼", effect: "sakura" },
			{ text: "ğŸ± å¾ˆæœ‰å¹²åŠ²å‘¢ï¼å®‰æ’æˆ‘å»å†…ç•ªå§ï¼", effect: "none" },
			{ text: "ğŸ’¤ ç¨å¾®æœ‰ç‚¹çŠ¯å›°ï¼Œæƒ³åˆç¡ä¸€ä¼šã€‚", effect: "none" },
			{ text: "ğŸ—ºï¸ å¶å°”ä¹Ÿæƒ³å»è¿œå¾çœ‹çœ‹å¤–é¢çš„ä¸–ç•Œå‘¢ã€‚", effect: "shake" }
        ];
        const randomMood = moods[Math.floor(Math.random() * moods.length)];
        cardMoodBtn.innerText = randomMood.text;
        cardMoodBtn.onclick = null;
        if (randomMood.effect === "sakura") createSakura();
    }

    function createSakura() {
        for (let i = 0; i < 20; i++) {
            const s = document.createElement('div');
            s.className = 'sakura'; s.innerHTML = 'ğŸŒ¸';
            s.style.left = Math.random() * 100 + 'vw';
            s.style.animationDuration = (Math.random() * 3 + 2) + 's';
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 5000);
        }
    }

    function renderEverything() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = "";
        const now = new Date();
        const days = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
        const unlockedSet = new Set(Object.values(historyData));

        ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(d => grid.innerHTML += `<div style="text-align:center;font-weight:bold">${d}</div>`);
        for (let i = 1; i <= days; i++) {
            const dateKey = `${now.getFullYear()}-${now.getMonth()+1}-${i}`;
            const winner = historyData[dateKey];
            const color = getCardColor(winner);
            grid.innerHTML += `<div class="calendar-day">${winner ? `<div class="calendar-day-accent" style="background:${color}">${i}</div><b>${winner}</b>` : `<div>${i}</div>`}</div>`;
        }

        for (let type in data) {
            const g = document.getElementById(`coll-${type}`); g.innerHTML = "";
            data[type].forEach(name => {
                const isU = unlockedSet.has(name);
                g.innerHTML += `<div class="collection-item ${isU?'unlocked':''}" style="${isU?`background:${getCardColor(name)}`:''}">${name}</div>`;
            });
        }
    }

    renderEverything();
</script>
</body>
</html>
